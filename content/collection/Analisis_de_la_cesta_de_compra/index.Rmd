---
date: "2021-01-01"
draft: false
excerpt: El estudio de las cestas de la compra permite explorar e interpretar la demanda de los clientes, comprender la relación entre los productos y las reglas para realizar una compra.
subtitle: "La principal tarea de un minorista es comprender quiénes son las personas que realizan compras en la tienda y, con la ayuda de este conocimiento, influir en la cantidad y calidad de las compras."
title: Análisis de la cesta de compra
weight: 1
---

## Algoritmo Apriori.
El algoritmo `Apriori` es uno de sus algoritmos que utilizamos en nuestras consultorías, fué propuesto por Agrawall y Srikant en 1994. Es un algoritmo de minería de datos, de reglas de asociación. El agoritmo Apriori opera con bases de datos de transacciones (artículos comprados por clientes), donde cada transacción es un conjunto de ítems.

El algoritmo apriori es muy utilizado en el marketing, sus usos son del tipo _“porque usted compró X, le podría interesar Y”_. Permite planificar mejor las campañas de marketing, las ventas y el merchandising (por ejemplo, es muy utilizado en supermercados, centros comerciales o mall), es por ello, que el algoritmo apriori es conocido también como el **Análisis de la Cesta de Compras**.

## Aspectos técnicos
### Indicadores de rendimiento
**Soporte (support)**: es  la frecuencia relativa de una regla con respecto al total de transacciones.

**Confianza (confidence)**: mide qué tan confiable es la suposición hecha por la regla. La confianza es “más” importante que el soporte, es decir, soporte y confianza deben ser analizados juntos.

**Empuje (lift)**: Ayuda a detectar si el producto que aparece en **rhs** (consecuente), se debe a que se dió la combinación de los productos que aparecen en la columna **lhs** (antecedente), o no.

**Lift > 1** => La probabilidad del consecuente (rhs) aumentó gracias a que se dió el antecedente (lhs).

**Lift = 1** => La probabilidad del consecuente (rhs) no se vió afectada por el antecedente (lhs) - los productos son independientes.

**Lift < 1** => La probabilidad del consecuente (rhs) disminuyó debido a que se dió el antecedente (lhs).

**Antecedente (lhs, left-hand size)**: Producto o productos comprados.

**Consecuente (rhs, right-hand size)**: Producto comprado debido a que se dió el antecedente.

**Regla de asociación**: {lhs} => {rhs}

### Reglas redundantes
El algoritmo por defecto genera reglas redundantes, se las debe quitar del resultado o se las omite. X => Y es rediundante si existe un subconjunto de X\', tal que exista una regla X\' => Y cuyo soporte sea mayor.

| Considere los siguientes ejemplos:   |   |   |
|---|---|---|
| [9] {Pan}             | => {Mantequilla}  | Support = 0.667  |
| [10] {Leche, Pan}     | => {Mantequilla}  | Support = 0.25   |
| [14] {Galletas, Pan}  | => {Mantequilla}  | Support = 0.25   |

Las reglas 10 y 14 son redundantes con la 9; se elimina a 10 y 14 (ya que tiene más productos y menor soporte), se queda la 9.

| Otro caso:   |   |   |
|---|---|---|
| [13] {Pan, Pan}          | => {Leche}  | Support = 0.583 |
| [15] {Mantequilla, Pan}  | => {Leche}  | Support = 0.5   |

La regla 15 es redundate con 9; se elimina la 15 (ya que tiene más productos y menor soporte); se queda la 13.

## Caso 1
Se cuenta con la siguiente base de datos de transacciones (compras que realizan 12 clientes en un supermercado).

```{r echo=FALSE, message=FALSE, warning=FALSE}
datos <- read.csv(file = 'canasta.csv',
                   header = T, sep = ';',
                   dec = ',')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# damos formato a los datos de transacciones
library(plyr)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# por cada transaccion se crea una fila que contenga todos los 
# productos separandolos por una coma
lista_productos <- ddply(datos, c('transaccion'),
                         function(df1)paste(df1$producto, collapse = ','))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# eliminamos la columna transaccion
lista_productos$transaccion <- NULL
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# guardamos el archivo lista_productos en formato CSV
write.csv(lista_productos, 'lista_productos.csv',
          quote = F, row.names = F)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# ahora ya tenemos el archivo lista productos en formato basket
# leemos el archivo con las transacciones que acabamos de guardar
library(arules)
transacciones <- read.transactions('lista_productos.csv',
                                   format = 'basket', sep = ',', header = F)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# visualizar transacciones en la consola
inspect(transacciones)

# grafica de los productos mas vendidos, top 10
itemFrequencyPlot(transacciones, topN = 10, type = 'absolute')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# obtener las reglas de asociacion por algoritmo a priori
reglas <- apriori(transacciones, parameter = list(supp = 0.1,
                                                  conf = 0.7,
                                                  minlen = 2))

# ordenamos las reglas de forma decreciente en base a su confianza
reglas <- sort(reglas, by = 'confidence', decreasing = T)

# visualizamos las reglas en pantalla
inspect(reglas)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# La salida genera 15 reglas de asociacion, ahora toca depurarlas
# busqueda de reglas duplicadas
duplicated(reglas)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# se buscan reglas redundantes, para eliminarlas si apareciesen
redundantes <- is.redundant(reglas)
redundantes
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# existen 5 reglas redundantes, para identificar las reglas:
which(is.redundant(reglas))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# las reglas redundantes son 4ta, 5ta, 10ma, 14va y 15va
# las elimimnamos, luego visualizamos las reglas de asociacion
# sin redundantes ni duplicados
reglas_podadas <- reglas[!redundantes]
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# visualizamos
inspect(reglas_podadas)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# se crea un grafo interactivo que permite interpretar las reglas de asociacion
# el analista puede mover los objetos generados en el grafico
library(arulesViz)
plot(reglas_podadas, method = 'graph',
     engine = 'interactive', shading = 'confidence')
```



